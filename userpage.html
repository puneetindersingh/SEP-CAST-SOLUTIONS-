<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>User | Cast Solution</title>
 <link rel="stylesheet" href="css/mainPage.css">
 <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body onload="checkCookie()">
<div class="row">

<!-- top nav -->

<div class="col-12 topnav" id="myTopnav">

  <a id="logoleftTop"><img id="logo" src="img/LOGO-01.png"/></a>
  <a href="#User"><i class="material-icons md-18 blue">face</i> <text id="user">USER</text></a>
  <a href="#Qlik"> Qlik</a>
  <a class="tablinks" onclick="openCity(event, 'contact')"><i class="material-icons md-18 blue">contact_phone</i> CONTACT</a>
  <a href="#about"><i class="material-icons md-18 blue">lightbulb_outline</i> ABOUT</a>
  <a href="javascript:void(0);" style="font-size:15px;" class="icon" onclick="topnav()">&#9776;</a>
</div>

<!-- side bar -->
<div class="col-2 menu">
  <ul>

    <li class="tablinks" onclick="openCity(event, 'modifyProfile')"><i class="material-icons md-18 blue">edit</i> Modify Profile</li>
    <li><i class="material-icons md-18 blue"> help</i> Help</li>
<li> <i class="material-icons md-18 blue">power_settings_new</i><a href="login.html" style="text-decoration: none;  color: black; "> Log Out</a></li>
    <li class="dropdown">
    <a class="dropbtn"><i class="material-icons md-18 blue">settings_applications</i> Settings</a>
    <div class="dropdown-content">
      <a class="tablinks" href="#" onclick="openCity(event, 'passReset')"><i class="material-icons md-18 blue">settings</i> Password Reset</a>
      <a href="#"><i class="material-icons md-18 blue">settings</i> Function 2</a>
      <a href="#"><i class="material-icons md-18 blue">settings</i> Function 3</a>
    </div>
  </li>
  </ul>
</div>

<!-- new form -->
<div class="col-14 divAddUser allform tabcontent" id="modifyProfile">
    <h4>User information</h4>
    <label for="fname">First Name</label>
    <input type="text" placeholder="Your name.." id="firstN">
    <label for="lname">Last Name</label>
    <input type="text" placeholder="Your last name.." id="lastN">
    <label for="lname">Email address</label>
    <input type="text" placeholder="Your email address.." id="emailAddress">
    <label for="lname">Phone number</label>
    <input type="text" placeholder="Your phone number.." id="phoneNo">
    <label for="lname">Company Name</label>
    <input type="text" placeholder="Your company name.." id="companyN">
    <label for="lname">Company Site Name</label>
    <input type="text" placeholder="Your company site name.." id="companySite">
    <label for="lname">Company Job Title</label>
    <input type="text" placeholder="Your company job title.." id="jobTitle">
    <input type="submit" name="edituser"value="Submit" onclick="updateProfile()">
</div>

<div class="col-14 divAddUser allform tabcontent" id="passReset">
  <form action="add_user.php" method="POST">
    <h4>Password Reset</h4>
    <label for="fname">Old Password</label>
    <input type="password"  name="oldpassword" placeholder="Your old password">
    <label for="fname">New Password</label>
    <input type="password"  name="newpassword" placeholder="Your new password">
    <input type="submit" name="resetpassword" value="Submit">
  </form>
</div>


 <!-- contact form -->
<div class="col-14 divAddUser allform tabcontent" id="contact">
  <form action="/action_page.php">
    <h4>Contact Us</h4>
    <label for="fname">Name</label>
    <input type="text" placeholder="Your name"required>
    <label for="fname">Email</label>
    <input type="email" placeholder="Your email"required>
    <label for="fname">Subject</label>
    <input type="text" placeholder="Subject"required>
    <label for="fname">Message</label>
    <textarea rows="10" type="text" placeholder="..."required></textarea>
    <input type="submit" value="Submit">
  </form>
</div>

<!-- <div class="col-12 right">
  <div class="aside">
    <h2>Space 1</h2>
    <p>These space for something use future</p>
    <h2>Space 2</h2>
    <p>These space for something use future</p>
    <h2>Space 3</h2>
    <p>These space for something use future</p>
  </div>
</div> -->

</div>

</body>

<script>

function topnav() {
    var x = document.getElementById("myTopnav");
    if (x.className === "col-12 topnav") {
        x.className += " responsive";
    } else {
        x.className = "col-12 topnav";
    }
}

function openCity(evt, cityName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(cityName).style.display = "block";
    evt.currentTarget.className += " active";
    if(cityName == "modifyProfile"){
      showProfile();
    }
}
// Get the element with id="defaultOpen" and click on it
document.getElementById("defaultOpen").click();

function getCookie(cname){
	var name = cname + "=";
	var ca = document.cookie.split(';');
	for(var i=0; i<ca.length; i++) {
		var c = ca[i].trim();
		if (c.indexOf(name)==0) return c.substring(name.length,c.length);
	}
	return "";
}

function checkCookie(){
	var user=getCookie("username");
	if (user!=""){
		document.getElementById('user').innerHTML = user;
	}
	else {
    alert('no exist cookie!');
	}
}

var xmlHttp;
function showProfile(){
  xmlHttp = GetXmlHttpObject();
if (xmlHttp==null)
 {
 alert ("Browser does not support HTTP Request");
 return 0;
 }
 var url='function-modified.php';
 var params = "";
 params += "profile=1&username="+document.getElementById('user').innerHTML;
 // var params = "username="+document.getElementById('reset-username').value+"&email="+document.getElementById('email-name').value;
 xmlHttp.open("POST",url,true);
 xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
 xmlHttp.onreadystatechange=stateChanged;
 xmlHttp.send(params);
}

function stateChanged(){
if (xmlHttp.readyState==4 || xmlHttp.readyState=="complete"){
  var str=xmlHttp.responseText;
  var obj = eval('(' + str + ')');
  document.getElementById('firstN').value = obj.firstname;
  document.getElementById('lastN').value = obj.lastname;
  document.getElementById('emailAddress').value = obj.email;
  document.getElementById('phoneNo').value = obj.phone;
  document.getElementById('companyN').value = obj.company;
  document.getElementById('companySite').value = obj.companysite;
  document.getElementById('jobTitle').value = obj.jobtitle;
 }
}

function GetXmlHttpObject(){
var xmlHttp=null;
try{
 // Firefox, Opera 8.0+, Safari
 xmlHttp=new XMLHttpRequest();
 }
catch (e){
 //Internet Explorer
 try{
  xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");
  }
 catch (e){
  xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
 }
return xmlHttp;
}

function updateProfile(){
  xmlHttp = GetXmlHttpObject();
if (xmlHttp==null)
 {
 alert ("Browser does not support HTTP Request");
 return 0;
 }
 var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
 var myreg1 = /^(\+61)[0-9]{1}[0-9]{4}[0-9]{4}$/;
 if(!myreg.test(document.getElementById('emailAddress').value)){
   alert("Please enter the correct email with '@' format!");
 }else if(!myreg1.test(document.getElementById('phoneNo').value)){
   alert("Please enter the Phone Number with '+61' at the front and 9 following numbers!");
 }else{
 var url='function-modified.php';
 var params = "";
 params += "updateprofile=1&username="+document.getElementById('user').innerHTML+"&firstname="+document.getElementById('firstN').value
 +"&lastname="+document.getElementById('lastN').value+"&email="+document.getElementById('emailAddress').value
 +"&phone="+document.getElementById('phoneNo').value+"&companyname="+document.getElementById('companyN').value
 +"&companysite="+document.getElementById('companySite').value+"&jobtitle="+document.getElementById('jobTitle').value;
 // var params = "username="+document.getElementById('reset-username').value+"&email="+document.getElementById('email-name').value;
 xmlHttp.open("POST",url,true);
 xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
 xmlHttp.onreadystatechange=stateChangedforProfie;
 xmlHttp.send(params);
}
}

function stateChangedforProfie(){
if (xmlHttp.readyState==4 || xmlHttp.readyState=="complete"){
  alert(xmlHttp.responseText);
 }
}

</script>
</html>
